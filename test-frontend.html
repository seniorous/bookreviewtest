<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å‰ç«¯APIé›†æˆæµ‹è¯•</title>
<style>
body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
.test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
.test-section h3 { margin-top: 0; color: #333; }
.form-group { margin: 10px 0; }
.form-group label { display: inline-block; width: 100px; }
.form-group input { padding: 5px; width: 200px; }
button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background: #0056b3; }
button:disabled { background: #ccc; cursor: not-allowed; }
.result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
.success { background: #d4edda; color: #155724; }
.error { background: #f8d7da; color: #721c24; }
</style>
</head>
<body>
<h1>ğŸ“š ä¹¦è¯„ç®¡ç†ç³»ç»Ÿ - å‰ç«¯APIé›†æˆæµ‹è¯•</h1>

<div class="test-section">
  <h3>ğŸ”— APIè¿æ¥æµ‹è¯•</h3>
  <button onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
  <div id="health-result" class="result"></div>
</div>

<div class="test-section">
  <h3>ğŸ“ ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h3>
  <div class="form-group">
    <label>é‚®ç®±:</label>
    <input type="email" id="reg-email" placeholder="test@example.com">
  </div>
  <div class="form-group">
    <label>ç”¨æˆ·å:</label>
    <input type="text" id="reg-username" placeholder="testuser">
  </div>
  <div class="form-group">
    <label>å¯†ç :</label>
    <input type="password" id="reg-password" placeholder="test1234">
  </div>
  <div class="form-group">
    <label>ç®€ä»‹:</label>
    <input type="text" id="reg-bio" placeholder="æµ‹è¯•ç”¨æˆ·ç®€ä»‹">
  </div>
  <button onclick="testRegister()">æ³¨å†Œæµ‹è¯•</button>
  <div id="register-result" class="result"></div>
</div>

<div class="test-section">
  <h3>ğŸ” ç”¨æˆ·ç™»å½•æµ‹è¯•</h3>
  <div class="form-group">
    <label>é‚®ç®±:</label>
    <input type="email" id="login-email" placeholder="test@example.com">
  </div>
  <div class="form-group">
    <label>å¯†ç :</label>
    <input type="password" id="login-password" placeholder="test1234">
  </div>
  <button onclick="testLogin()">ç™»å½•æµ‹è¯•</button>
  <div id="login-result" class="result"></div>
</div>

<div class="test-section">
  <h3>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯æµ‹è¯•</h3>
  <button onclick="testProfile()">è·å–ç”¨æˆ·ä¿¡æ¯</button>
  <button onclick="testLogout()">é€€å‡ºç™»å½•</button>
  <div id="profile-result" class="result"></div>
</div>

<div class="test-section">
  <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
  <button onclick="showCurrentStatus()">æ˜¾ç¤ºå½“å‰çŠ¶æ€</button>
  <div id="status-result" class="result"></div>
</div>

<!-- å¼•å…¥APIå·¥å…· -->
<script src="js/api.js"></script>

<script>
// å¥åº·æ£€æŸ¥æµ‹è¯•
async function testHealthCheck() {
  const resultDiv = document.getElementById('health-result');
  resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•...';
  
  try {
    const response = await fetch('http://localhost:3001/api/health');
    const data = await response.json();
    
    resultDiv.className = 'result success';
    resultDiv.innerHTML = `
      âœ… å¥åº·æ£€æŸ¥é€šè¿‡<br>
      æœåŠ¡å™¨çŠ¶æ€: ${data.status}<br>
      æ•°æ®åº“: ${data.database.status}<br>
      è¿è¡Œæ—¶é—´: ${data.uptime}ç§’<br>
      å†…å­˜ä½¿ç”¨: ${data.memory.used}/${data.memory.total} MB
    `;
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.textContent = `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`;
  }
}

// æ³¨å†Œæµ‹è¯•
async function testRegister() {
  const resultDiv = document.getElementById('register-result');
  resultDiv.textContent = 'æ­£åœ¨æ³¨å†Œ...';
  
  try {
    const email = document.getElementById('reg-email').value;
    const username = document.getElementById('reg-username').value;
    const password = document.getElementById('reg-password').value;
    const bio = document.getElementById('reg-bio').value;
    
    if (!email || !username || !password) {
      throw new Error('è¯·å¡«å†™é‚®ç®±ã€ç”¨æˆ·åå’Œå¯†ç ');
    }
    
    const response = await api.register(email, username, password, bio);
    
    resultDiv.className = 'result success';
    resultDiv.innerHTML = `
      âœ… æ³¨å†ŒæˆåŠŸ<br>
      ç”¨æˆ·ID: ${response.data.user.id}<br>
      ç”¨æˆ·å: ${response.data.user.username}<br>
      é‚®ç®±: ${response.data.user.email}<br>
      è§’è‰²: ${response.data.user.role}
    `;
    
    // æ¸…ç©ºè¡¨å•
    document.getElementById('reg-email').value = '';
    document.getElementById('reg-username').value = '';
    document.getElementById('reg-password').value = '';
    document.getElementById('reg-bio').value = '';
    
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.textContent = `âŒ æ³¨å†Œå¤±è´¥: ${error.message}`;
  }
}

// ç™»å½•æµ‹è¯•
async function testLogin() {
  const resultDiv = document.getElementById('login-result');
  resultDiv.textContent = 'æ­£åœ¨ç™»å½•...';
  
  try {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
      throw new Error('è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ');
    }
    
    const response = await api.login(email, password);
    
    resultDiv.className = 'result success';
    resultDiv.innerHTML = `
      âœ… ç™»å½•æˆåŠŸ<br>
      ç”¨æˆ·å: ${response.data.user.username}<br>
      é‚®ç®±: ${response.data.user.email}<br>
      è§’è‰²: ${response.data.user.role}<br>
      ä»¤ç‰Œå·²ä¿å­˜åˆ°localStorage
    `;
    
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.textContent = `âŒ ç™»å½•å¤±è´¥: ${error.message}`;
  }
}

// ç”¨æˆ·ä¿¡æ¯æµ‹è¯•
async function testProfile() {
  const resultDiv = document.getElementById('profile-result');
  resultDiv.textContent = 'æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯...';
  
  try {
    if (!api.isLoggedIn()) {
      throw new Error('è¯·å…ˆç™»å½•');
    }
    
    const response = await api.getProfile();
    
    resultDiv.className = 'result success';
    resultDiv.innerHTML = `
      âœ… ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ<br>
      ç”¨æˆ·å: ${response.data.user.username}<br>
      é‚®ç®±: ${response.data.user.email}<br>
      è§’è‰²: ${response.data.user.role}<br>
      ä¹¦è¯„æ•°é‡: ${response.data.user.total_reviews}<br>
      æ”¶åˆ°ç‚¹èµ: ${response.data.user.total_likes_received}<br>
      æ”¶è—æ•°é‡: ${response.data.user.favorites_count}<br>
      åˆ›å»ºæ—¶é—´: ${new Date(response.data.user.created_at).toLocaleString()}
    `;
    
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.textContent = `âŒ è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}`;
  }
}

// é€€å‡ºç™»å½•æµ‹è¯•
async function testLogout() {
  const resultDiv = document.getElementById('profile-result');
  
  try {
    await api.logout();
    resultDiv.className = 'result success';
    resultDiv.textContent = 'âœ… é€€å‡ºç™»å½•æˆåŠŸï¼ŒlocalStorageå·²æ¸…ç©º';
    
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.textContent = `âŒ é€€å‡ºç™»å½•å¤±è´¥: ${error.message}`;
  }
}

// æ˜¾ç¤ºå½“å‰çŠ¶æ€
function showCurrentStatus() {
  const resultDiv = document.getElementById('status-result');
  const isLoggedIn = api.isLoggedIn();
  const currentUser = api.getCurrentUser();
  
  if (isLoggedIn && currentUser) {
    resultDiv.className = 'result success';
    resultDiv.innerHTML = `
      ğŸŸ¢ å·²ç™»å½•çŠ¶æ€<br>
      å½“å‰ç”¨æˆ·: ${currentUser.username}<br>
      é‚®ç®±: ${currentUser.email}<br>
      è§’è‰²: ${currentUser.role}<br>
      ä»¤ç‰Œ: ${api.token ? 'å·²å­˜å‚¨' : 'æœªå­˜å‚¨'}
    `;
  } else {
    resultDiv.className = 'result';
    resultDiv.textContent = 'ğŸ”´ æœªç™»å½•çŠ¶æ€';
  }
}

// é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºçŠ¶æ€
window.addEventListener('load', () => {
  showCurrentStatus();
  
  // è®¾ç½®é»˜è®¤æµ‹è¯•æ•°æ®
  const now = Date.now();
  document.getElementById('reg-email').value = `test${now}@example.com`;
  document.getElementById('reg-username').value = `user${now}`;
  document.getElementById('reg-password').value = 'test1234';
  document.getElementById('reg-bio').value = 'å‰ç«¯é›†æˆæµ‹è¯•ç”¨æˆ·';
});
</script>

</body>
</html>
