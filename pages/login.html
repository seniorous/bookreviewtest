<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç™»å½• - ä¹¦è¯„ç®¡ç†ç³»ç»Ÿ</title>

<!-- APIå·¥å…· -->
<script src="../js/api.js"></script>
<style>
*{box-sizing:border-box}body{margin:0;background:linear-gradient(120deg,#fff7f0,#ffffff 40%,#f7f7f7);font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Noto Sans",Arial}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.card{width:420px;max-width:92vw;border:1px solid #e9e9e9;border-radius:12px;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.04);overflow:hidden}
.header{display:flex;align-items:center;gap:16px;padding:14px 16px;border-bottom:1px solid #f1f1f1}
.header .tab{flex:1;padding:10px 0;border:none;background:transparent;font-size:16px;cursor:pointer}
.header .tab.active{color:#ff6a00;font-weight:700;border-bottom:2px solid #ff6a00}
.header .tip{font-size:12px;color:#999}
.body{padding:18px}
.input{display:flex;align-items:center;border:1px solid #ddd;border-radius:8px;padding:10px 12px;margin-bottom:12px}
.input input{border:none;outline:none;flex:1;font-size:14px}
.icon{width:20px;text-align:center;margin-right:8px;opacity:.7}
.btn{width:100%;padding:12px 14px;border:none;border-radius:8px;background:#ff6a00;color:#fff;cursor:pointer;margin-top:6px}
.sub{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-top:10px}
.oauth{display:flex;align-items:center;gap:10px;margin-top:12px;color:#666;font-size:14px}
.oauth a{display:inline-block;padding:6px 10px;border-radius:8px;border:1px solid #eee}
.footer{display:flex;gap:16px;justify-content:space-between;margin-top:12px;font-size:13px}
.code-group{display:flex;gap:8px}
.code-btn{white-space:nowrap;border:1px solid #ddd;border-radius:8px;background:#fff;padding:8px 10px;cursor:pointer}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <h2>ç”¨æˆ·ç™»å½•</h2>
    </div>

    <div class="body">
      <!-- å¯†ç ç™»å½• -->
      <form id="pwdForm">
        <div class="input"><span class="icon">ğŸ‘¤</span>
          <input name="email" type="email" placeholder="é‚®ç®±åœ°å€" required>
        </div>
        <div class="input"><span class="icon">ğŸ”’</span>
          <input name="password" type="password" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç " required>
        </div>
        <button class="btn" type="submit">ç™»å½•</button>
      </form>




      <div class="footer">
        <a href="register.html">å…è´¹æ³¨å†Œ</a>
        <a href="../index.html">è¿”å›é¦–é¡µ</a>
      </div>
    </div>
  </div>
</div>

<script>
// ç™»å½•å¤„ç†
document.getElementById('pwdForm').onsubmit = async (e) => {
  e.preventDefault();
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  
  try {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    submitBtn.disabled = true;
    submitBtn.textContent = 'ç™»å½•ä¸­...';
    
    const formData = new FormData(e.target);
    const email = formData.get('email');
    const password = formData.get('password');
    
    // è°ƒç”¨ç™»å½•API
    const response = await api.login(email, password);
    
    alert('ç™»å½•æˆåŠŸï¼');
    location.href = '../index.html';
    
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error);
    
    let errorMessage = 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ';
    
    // æ ¹æ®é”™è¯¯ä¿¡æ¯æä¾›æ›´å‹å¥½çš„æç¤º
    if (error.message.includes('é‚®ç®±æˆ–å¯†ç é”™è¯¯')) {
      errorMessage = 'é‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
    } else if (error.message.includes('è´¦æˆ·å·²è¢«ç¦ç”¨')) {
      errorMessage = 'è´¦æˆ·å·²è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜';
    } else if (error.message.includes('è¯·æ±‚è¿‡äºé¢‘ç¹')) {
      errorMessage = 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
    } else if (error.message.includes('é‚®ç®±æ ¼å¼')) {
      errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';
    }
    
    alert(errorMessage);
  } finally {
    // æ¢å¤æŒ‰é’®çŠ¶æ€
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
};

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
window.addEventListener('load', () => {
  if (api.isLoggedIn()) {
    location.href = '../index.html';
  }
});

</script>
</body>
</html>