<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æ³¨å†Œ - ä¹¦è¯„ç®¡ç†ç³»ç»Ÿ</title>

<!-- APIå·¥å…· -->
<script src="../js/api.js"></script>
<style>
*{box-sizing:border-box}body{margin:0;background:#fafafa;font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Noto Sans",Arial}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.card{width:520px;max-width:94vw;border:1px solid #eaeaea;border-radius:12px;background:#fff;box-shadow:0 8px 30px rgba(0,0,0,.04);padding:18px}
h2{margin:4px 0 14px}
.row{display:flex;gap:10px}
.input{display:flex;align-items:center;border:1px solid #ddd;border-radius:8px;padding:10px 12px;margin-bottom:12px}
.input input{border:none;outline:none;flex:1;font-size:14px}
.btn{width:100%;padding:12px 14px;border:none;border-radius:8px;background:#ff6a00;color:#fff;cursor:pointer;margin-top:6px}
.tip{font-size:13px;color:#666;margin-top:10px}
a{color:#ff6a00;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>å…è´¹æ³¨å†Œ</h2>
    <form id="form">
      <div class="row">
        <div class="input" style="flex:1"><span>ğŸ‘¤&nbsp;</span><input name="username" placeholder="ç”¨æˆ·å" required></div>
      </div>
      <div class="row">
        <div class="input" style="flex:1"><span>ğŸ“§&nbsp;</span><input type="email" name="email" placeholder="é‚®ç®±" required></div>
      </div>
      <div class="row">
        <div class="input" style="flex:1"><span>ğŸ”’&nbsp;</span><input type="password" name="password" placeholder="è®¾ç½®ç™»å½•å¯†ç ï¼ˆ8ä½ä»¥ä¸Šï¼‰" minlength="8" required></div>
        <div class="input" style="flex:1"><span>ğŸ”’&nbsp;</span><input type="password" name="confirm" placeholder="ç¡®è®¤å¯†ç " minlength="8" required></div>
      </div>
      <div class="tip" style="margin-top:0;margin-bottom:12px;color:#888;font-size:12px;">ğŸ’¡ å¯†ç è¦æ±‚ï¼šè‡³å°‘8ä¸ªå­—ç¬¦ï¼Œå¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—</div>
      <button class="btn" type="submit">æ³¨å†Œå¹¶ç™»å½•</button>
    </form>
    <div class="tip">å·²æœ‰è´¦å·ï¼Ÿ<a href="login.html">å»ç™»å½•</a></div>
  </div>
</div>

<script>
document.getElementById('form').onsubmit = async (e) => {
  e.preventDefault();
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  
  try {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    submitBtn.disabled = true;
    submitBtn.textContent = 'æ³¨å†Œä¸­...';
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    
    // å‰ç«¯éªŒè¯
    if (data.password !== data.confirm) {
      alert('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
      return;
    }
    
    if (data.password.length < 8) {
      alert('å¯†ç é•¿åº¦è‡³å°‘8ä½');
      return;
    }
    
    // æ£€æŸ¥å¯†ç æ˜¯å¦åŒ…å«å­—æ¯å’Œæ•°å­—
    if (!/[a-zA-Z]/.test(data.password) || !/\d/.test(data.password)) {
      alert('å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—');
      return;
    }
    
    // è°ƒç”¨æ³¨å†ŒAPI
    const response = await api.register(
      data.email, 
      data.username, 
      data.password, 
      data.bio || ''
    );
    
    alert('æ³¨å†ŒæˆåŠŸï¼Œå·²è‡ªåŠ¨ç™»å½•ï¼');
    location.href = '../index.html';
    
  } catch (error) {
    console.error('æ³¨å†Œå¤±è´¥:', error);
    let errorMessage = 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•';
    
    // æ ¹æ®APIè¿”å›çš„é”™è¯¯ä¿¡æ¯æä¾›å‹å¥½æç¤º
    if (error.message.includes('è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ')) {
      errorMessage = 'è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–é‚®ç®±æˆ–ç›´æ¥ç™»å½•';
    } else if (error.message.includes('è¯¥ç”¨æˆ·åå·²è¢«ä½¿ç”¨')) {
      errorMessage = 'è¯¥ç”¨æˆ·åå·²è¢«ä½¿ç”¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·å';
    } else if (error.message.includes('é‚®ç®±æ ¼å¼')) {
      errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';
    } else if (error.message.includes('å¯†ç ä¸ç¬¦åˆè¦æ±‚')) {
      errorMessage = 'å¯†ç éœ€è¦8ä½ä»¥ä¸Šï¼Œä¸”åŒ…å«å­—æ¯å’Œæ•°å­—';
    } else if (error.message.includes('ç”¨æˆ·ååªèƒ½åŒ…å«')) {
      errorMessage = 'ç”¨æˆ·ååªèƒ½åŒ…å«ä¸­æ–‡ã€å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿';
    } else if (error.message.includes('ç”¨æˆ·åé•¿åº¦')) {
      errorMessage = 'ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-20ä½ä¹‹é—´';
    } else if (error.message.includes('è¯·æ±‚è¿‡äºé¢‘ç¹')) {
      errorMessage = 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
    }
    
    alert(errorMessage);
  } finally {
    // æ¢å¤æŒ‰é’®çŠ¶æ€
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
};

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
window.addEventListener('load', () => {
  if (api.isLoggedIn()) {
    location.href = '../index.html';
  }
});
</script>
</body>
</html>